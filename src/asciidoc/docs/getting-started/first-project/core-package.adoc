= The @withkoji/core package
:page-slug: core-package
:page-description: Installing the @withkoji/core package and using it to capture user input.
:figure-caption!:

In the <<tut-first-project-basics#,previous section>> of this tutorial, you created a new project by forking an existing one, made minor edits, and then published the app.
In this section, you’ll
// tag::description[]
continue using the code editor to install and use the @withkoji/core package.
// end::description[]

In this section, you will learn how to:

* Use the terminal feature inside the code editor to run commands.
* Install and import the @withkoji/core package into your project.
* Use the @withkoji/core package to capture input from a user.

== The JavaScript ecosystem

JavaScript was introduced as a way to build more complex user experiences, and it has become the primary language in which most web applications are written today. Therefore, Koji features and tools for developers are built with and for JavaScript and its surrounding ecosystem.

This support means that you can easily use popular JavaScript frameworks, such as React, Vue, and Svelte in your development.
It also means that you have access to NPM, the world's largest software registry, which has over 1.5 million packages ready to install and use in your project.

In this section, you will learn about the primary Koji package @withkoji/core, which exposes many of Koji’s powerful platform features in an easy-to-use set of modules and methods.

== Installing a package

Koji’s code editor has a built-in terminal or command-line interface (CLI), which you use to send text-based commands to the Koji platform.
By default, the terminal pane is minimized at the bottom of the code editor.

* To expand the terminal pane, you can click any of the existing terminal tabs or the chevron (image:chevron.svg[chevron icon]) at the rightmost end of the pane.
* To minimize the terminal pane, you can click the active tab or the chevron.

You will use this terminal to install the @withkoji/core package and to stop and start the service that supports your app preview.

=== Exercise 2.1: Install @withkoji/core

. <<tut-first-project-basics#_exercise_1_7_reopen_your_project,Open the *Project Details* page for your project>> and then click *Open in Code Editor*.

. At the bottom of the code editor, click the *frontend* tab of the terminal pane.
+
By default, the messages would indicate that the project compiled successfully and is available at [.filepath]#\https://localhost:8080#.

. Stop the running service.
.. Click inside the terminal.
.. Press kbd:[Ctrl+C] or kbd:[Cmd+C].

. Install the @withkoji/core package.
+
[source,bash]
----
npm install @withkoji/core
----
+
NPM displays the status as it requests the latest package details and installs the package in the project.

. When installation is complete, restart the service.
+
[source,bash]
----
npm start
----
+
This triggers React to recompile your project and then start the service.
The terminal will display the same messages as it did before you stopped the process.

. Minimize the terminal pane.

NOTE: If you add a backend to your app, you must also install the package in the *backend* tab.
This tutorial does not include a backend component.

== Importing the package

After installation, you must import the package in your project.

The scaffold that you forked was designed for React.
With React, you only need one line of code to import the package.

=== Exercise 2.2: Import the package and read the app's initial settings

. From the navigation pane, open the file [.filepath]#/frontend/src/index.js#.

. Modify the code to look as follows:
+
[source, javascript]
----
import React from 'react';
import ReactDOM from 'react-dom';
import Koji from '@withkoji/core';  // <1>
import kojiConfig from '../../koji.json';  // <2>
import './index.css';
import App from './App';

Koji.config(kojiConfig, {  // <3>
  projectId: process.env.REACT_APP_PROJECT_ID,
  services: {
    frontend: process.env.REACT_APP_FRONTEND_URL,
  },
});

ReactDOM.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
  document.getElementById('root')
);
----
<1> Imports `Koji`, which is the default object exported by the `@withkoji/core` package.
<2> Imports the `koji.json` file as `kojiConfig`. This file contains the initial settings of your app.
<3> Calls `Koji.config` with the `kojiConfig` object and other parameters to provide your app's initial settings to the package.

NOTE: By calling `Koji.config` outside of React’s render loop, it is called exactly once, when the application initially loads.
Calling `Koji.config` multiple times throws an error.

Now, you are ready to use the modules and methods from the @withkoji/core package.

== About the React state

In React, [.term]#state# is the set of information that your app needs while running.

Most web applications use state in various ways, such as whether the user selected light or dark mode, whether a section of content is expanded or collapsed, or whether the user is logged in or not.

In this tutorial, you will use state to store the URL of the rotating image.

=== Exercise 2.3: Store the image URL in state

. From the navigation pane, open the file [.filepath]#/frontend/src/App.js#.

. Modify the code to look as follows:
+
[source, javascript]
----
import { useState } from 'react';  // <1> <2>
import './App.css';

function App() {
  const [logoSrc, setLogoSrc] = useState('https://upload.wikimedia.org/wikipedia/commons/a/a7/React-icon.svg');  // <3>
  return (
    <div className="App">
      <header className="App-header">
        <img src={logoSrc} className="App-logo" alt="logo" />  // <4>
        <p>Getting Started with Koji</p>
      </header>
    </div>
  );
}

export default App;
----
<1> Removed the statement that imported the local `logo.svg` file.
<2> Imports `useState` from `react`, which is a React hook that allows you to manage the state inside the component.
<3> Calls the `useState` hook to initialize `logoSrc` with https://upload.wikimedia.org/wikipedia/commons/a/a7/React-icon.svg[the publicly available React logo from Wikimedia Commons].
<4> Uses the new const `logoSrc` as the source of the image, instead of the previously imported `logo`.

The syntax for the `useState` hook is as follows:

[source,javascript]
----
const [myValue, functionToSetMyValue] = useState(initialValue);
----

where the reactive variable `myValue` is initialized with `initialValue` and can be updated using `functionToSetMyValue`.


This allows you to easily replace the image by calling `setLogoSrc` to change the value of `logoSrc`.




== Capturing user input with @withkoji/core

Capturing user input is a fundamental part of the user experience on the internet.
Filling out forms, uploading files, and toggling buttons are all ways in which a user can interact with a web application.

One of Koji’s goals is to make capturing a user’s input easy for developers and intuitive for users.
To accomplish this goal, the Koji platform has exposed a number of methods for capturing different types of dynamic user inputs.

Let’s take a look at one of those methods in action: `Koji.ui.capture.image`.

As you can probably guess, this method allows you to capture an image input from a user.
You might be wondering how this method is different from the traditional `<input type="file" />`, which allows a user to select an image file from their computer.
Let’s find out.

Update the code in `frontend/src/App.js` as follows.

[source, javascript]
----
import Koji from '@withkoji/core';
import { useState } from 'react';
import './App.css';

function App() {
  const [logoSrc, setLogoSrc] = useState('https://upload.wikimedia.org/wikipedia/commons/a/a7/React-icon.svg');
  const captureImage = async () => {
    const src = await Koji.ui.capture.image();

    if (src) setLogoSrc(() => src);
  };
  return (
    <div className="App">
      <header className="App-header">
        <button onClick={captureImage}>Capture Image</button>
        <img src={logoSrc} className="App-logo" alt="logo" />
        <p>Some New Text</p>
      </header>
    </div>
  );
}

export default App;
----

You’ll notice a few small changes.
First, you’re importing `Koji` again at the top of the file.
Second, you added a button that will call the `captureImage` function when it’s clicked.

The `captureImage` function requests user input by using the `Koji.ui.capture.image` method.
If a value is returned, `setLogoSrc` is called and the state is updated with a new value.

Let’s give it a try.
To make sure you are seeing the most updated version of your application, click the *Refresh* icon in the preview.

image::CP_06_refresh-button.png[The refresh button]

Click *Capture Image*.

You’ll see a few things.
In addition to supporting a traditional file upload, a user can paste an image from a URL or browse one of Koji’s many image asset packs to find an image.
There are also options to search the web for an image or to use one of the pre-configured bundles of images.

Feel free to spend some time testing this feature out, and notice that when you upload or choose an image, it's automatically updated in the preview window.

== Under the hood

One thing that’s not so obvious is what happens under the hood when a user chooses an image.
The image is automatically uploaded, hosted, and optimized by Koji’s CDN.
The whole process is blazing fast and the image is intelligently cached.
In addition, you gain access to a ton of interesting configuration options.

Let’s test out one option by changing a line in `frontend/src/App.js`.
(Don’t forget to save!)

Change

`const src = await Koji.ui.capture.image();`

to

`const src = await Koji.ui.capture.image({ blur: 10 });`

Now, try choosing a new image.
You’ll see that the new image has a blur effect applied to it.
The blur isn’t just a style or CSS property.
The image is actually being transformed and served back at a URL on a custom, Koji-backed CDN!

== Republishing

We’re just starting to scratch the surface of the ways in which Koji can give a traditional web application super powers.
Make sure you save your progress by publishing a new version of the project.

Navigate back to *Publish Settings* by clicking *Publish Now*.

Click *Publish New Version* to publish your latest changes.

After your project has been published, feel free to check out the link to the latest live version and experience your image capture in the wild.

== Wrapping up

You should now be familiar with using the terminal to make command line changes to your project, as well as installing and importing the @withkoji/core package.
You also learned how to capture an image value from a user and how to do a some state management in React.

In the <<your-first-remix#,next section>>, we’ll take a step back from the code and start to explore the real power of Koji.

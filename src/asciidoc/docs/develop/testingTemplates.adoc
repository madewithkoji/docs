= Testing templates
:page-slug: testing-templates
:page-description: A consolidated resource for methods a developer can use to test templates

There are many ways you can test your Koji templates.
Typically, you will begin testing in the Koji editor.
Later, you'll want to publish the template as *Unlisted*, so you can test it in a production environment before giving access to general users.
Some of the most common testing methods are listed below.

== Testing in the Koji editor

There are many options in the Koji editor for previewing a template's behavior.
These are covered in more detail in the documentation for the editor (see <<editor#>>).

=== Previewing the Koji

The *Live preview* tab allows you to toggle between *Preview* mode, which shows what the Koji looks like when running, and *Editing* mode, which allows you to perform remixing in the preview.

The *Remote* tab offers several additional ways of previewing your Koji.
You can test it on your mobile device by scanning a QR code.
There are also options for opening the Koji in a new tab, running it in a live player, or copying the link for the preview.
If you share this link with someone else, they can preview the Koji while it's still in development.

[NOTE]
The remote preview link will only work for as long as your editor session is still active, so it is not suitable for long-term sharing.

The *Routes* tab lets you test your backend routes.
It's similar to using a program like curl or Fiddler.
For instance, you can manually enter an HTTP request, configure a header for it, send the request, and examine the results returned by the server.

=== Writing to the console

You can test JavaScript code by using the `console.log` method, which prints to the console.
To see the console in the Koji editor, open the *Thumbnail* tab and click on the console button:
image:consoleButton.jpg[Console button]

For example, the following code snippet prints *Key pressed* to the console every time you press a key, as long as the *Live preview* pane is selected.

[NOTE]
You can select *Live preview* by clicking anywhere in its pane.

[source,javascript]
----
    $(window).keydown(function (e) {
        KEY_STATUS.keyDown = true;
        if (KEY_CODES[e.keyCode]) {
            e.preventDefault();
            KEY_STATUS[KEY_CODES[e.keyCode]] = true;
        }
        console.log("Key pressed");
    }).keyup(function (e) {
        KEY_STATUS.keyDown = false;
        if (KEY_CODES[e.keyCode]) {
            e.preventDefault();
            KEY_STATUS[KEY_CODES[e.keyCode]] = false;
        }
    });
----

When running your Koji outside the editor, either in production or as a preview, you can access the console through the browser's menu.
(See <<testing-templates#_using_browser_tools_for_testing,Using browser tools for testing>>.)

=== Testing In-app purchases

You can test *In-app purchases* by using *Debug in live player* on the *Remote* tab.

. First, make sure you've topped up your *Wallet* in *KojiPay*.
You'll be using the Koji to send money to yourself, so you'll be able to issue yourself a refund when you finish testing.

. Run your Koji in *Debug in live player* and try paying yourself a small amount.
If all goes well, you'll see this amount deducted from your *Wallet*.
The transaction will be marked *pending*.

. You should be able to refund the transaction, resetting your balance to its original value and cancelling the transaction fee.

[NOTE]
If *KojiPay* doesn't allow you to refund the transaction, wait a minute or two and try again.
It may not be finished processing.

=== Testing a social media share

When a user shares a remix of your template on social media, the Koji platform renders a rich preview (Open Graph) image based on a screenshot of the Koji. You can preview this image by opening the *Thumbnail* tab in the *Live preview* pane. See <<rich-preview-image#>> for information on how to customize the preview image.

=== Viewing messages passed between Koji and the iframe

Your Koji is displayed in an iframe in the browser.
Messages are passed back and forth between the iframe and Koji.
To view these messages, click the view messages button at the bottom of the *Live preview* pane:
image:messagesButton.jpg[View messages]

=== Testing feed autoplay

If you have videos or audio files in your Koji that play automatically, you may want them to play only when they are visible to the user.
For instance, if the user scrolls past a video, it should start playing when it first scrolls into view and stop playing when it scrolls offscreen.

To test the autoplay feature, click on *Debug in live player* to open the Koji in a new tab (see <<testing-templates#_Previewing _the_Koji)>>). Append `?feedDebug=true` to the URL.
The template is loaded in the feed 10 times and you can swipe or scroll through to ensure the animation starts and stops as expected.
You can perform the same test in production mode.

[NOTE]
`Open in new tab` will not work.
This takes you to a staging area, where this feature is not available.

=== Using the Database Explorer

If your project uses the Koji database, you can test that it is working correctly by using the Database Explorer.
(See <<withkoji-database-package#>>.)

In the pane on the left-hand side of the editor, select *ADVANCED > Database*.
This will open the Database Explorer in the central panel. You should see a list of your tables.

Click on a table in the list to display its contents.

You can now use *Live preview > Default* to test your database setup.
Perform an action in the preview that should write a record to the selected table, then click *Refresh* in the *Database* tab.
If the record insertion worked, you should see the new record displayed.

[NOTE]
It may take a few seconds for the database to be updated.
If the new record does not appear in the table, try refreshing again.

You can delete a record from the table by clicking the trashcan icon at the end of the row.
The preview will not be updated automatically.
You can force it to refresh by clicking on the *Remix* tab and then clicking back on the *Default* tab.

This testing method works equally well when running the Koji in a new tab, in production, on a mobile device, etc.
In those cases, you can just refresh the browser to update the Koji after deleting a record.

== Using browser tools for testing

All modern browsers provide tools for debugging websites.
For example, in Google Chrome, you can open the debugging tools by clicking *More tools > Developer tools* or by pressing the F12 key.

== Testing your Koji in the production environment

If you publish your template as *Unlisted*, you can test it under exactly the same conditions as a general user, but no one else will be able to see it unless you send them the direct link.

. Click *Publish now*.

. Click *Show advanced options* near the bottom of the form.

. Select *Unlisted*.

. Click *Publish* and follow the directions to publish your template.

image::publishUnlisted.jpg[Select *Unlisted*]

When you're ready to give general users access, just unselect the checkbox and republish the template.


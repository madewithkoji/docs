= Testing templates
:page-slug: testing-templates
:page-description: A consolidated resource for methods a developer can use to test templates

There are many ways you can test your Koji templates.
Typically, you will begin testing in the Koji editor.
Later, you'll want to publish the template as *Unlisted*, so you can test it in a production environment before giving access to general users.
Some of the most common testing methods are listed below.

== Testing in the Koji editor

There are many options in the Koji editor for previewing a template's behavior.
These are covered in more detail in the documentation for the editor (see <<editor#>>).

=== Previewing the Koji

The *Live preview* tab allows you to toggle between *Preview* mode, which shows what the Koji looks like when running, and *Editing* mode, which allows you to perform remixing in the preview.

The *Remote* tab offers several additional ways of previewing your Koji.
You can test it on your mobile device by scanning a QR code.
There are also options for opening the Koji in a new tab, running it in a live player, or copying the link for the preview.
If you share this link with someone else, they can preview the Koji while it's still in development.

[NOTE]
The remote preview link will only work for as long as your editor session is still active, so it is not suitable for long-term sharing.

The *Routes* tab lets you test your backend routes.
It's similar to using a program like curl or Fiddler.
For instance, you can manually enter an HTTP request, configure a header for it, send the request, and examine the results returned by the server.

=== Writing to the console

You can test javascript code by using the `console.log` method.
This method prints to the console.
To see the console in the Koji editor, open the *Thumbnail* tab and click on the following button:

image::consoleButton.jpg[Console button]

For example, the following code snippet prints *Key pressed* to the Koji console every time you press a key, as long as the *Live preview* pane is selected.

[NOTE]
You can select *Live preview* by clicking anywhere in its pane.

[source,javascript]
----
    $(window).keydown(function (e) {
        KEY_STATUS.keyDown = true;
        if (KEY_CODES[e.keyCode]) {
            e.preventDefault();
            KEY_STATUS[KEY_CODES[e.keyCode]] = true;
        }
        console.log("Key pressed");
    }).keyup(function (e) {
        KEY_STATUS.keyDown = false;
        if (KEY_CODES[e.keyCode]) {
            e.preventDefault();
            KEY_STATUS[KEY_CODES[e.keyCode]] = false;
        }
    });
----

When running your Koji outside the editor, either in production or as a preview, you can access the console through the browser's menu.
See *Using browser tools for testing* for details.

=== Testing in-app purchasing

The @withkoji/iap package enables you to implement in-app purchases in your Koji templates.
See <<withkoji-koji-iap-package#>> for details.

After you've set up in-app purchasing, you can test it by using *Debug in live player* on the *Remote* tab.
First, make sure you've topped up your *Wallet* in *KojiPay*.
You'll be using the Koji to send money to yourself, so you'll be able to issue yourself a refund when you finish testing.

Next, run your Koji in *Debug in live player* and try paying yourself a small amount.
If all goes well, you'll see this amount deducted from your *Wallet*.
The transaction will be marked *pending*.
You should be able to refund the transaction, resetting your balance to its original value and cancelling the transaction fee.

[NOTE]
If *KojiPay* doesn't allow you to refund the transaction, wait a few minutes and try again.
It may not be finished processing.

=== Testing a share

You can share your Koji on social media by clicking the Koji button at the top right of the Koji screen and then clicking the *Share* button.
This will display a menu of options, including *Share to Facebook*, *Share to Reddit*, and *Share to Twitter*.

If you choose *Share to Facebook*, it will prompt you to log in to Facebook.
It will then take you to a dialog box where you can set various options for your post.
One of those options allow you to choose who will be able to see the post.
If you choose *Only me*, then you will be the only one who is able to see it.
After viewing the post on your Facebook feed, you can either delete it or edit it to change who is able to see it.

There is no option for previewing a post on Reddit or Twitter.

=== Viewing messages passed between Koji and the iframe

Your Koji is displayed in an iframe in the browser.
Messages are passed back and forth between the iframe and Koji.
You can view these messages in the Koji editor.

The *Live preview* pane includes a tab that displays a thumbnail for the Koji.
Below the thumbnail are a number of buttons.

Find the button that looks like this:

image::bridgeMessagesButton.jpg[View messages]

Click this button to open a pane that displays the messages.

=== Testing feed autoplay

If you have videos or audio files in your Koji that play automatically, you may want them to play only when they are visible to the user.
For instance, if the user scrolls past a video, it should start playing when it first scrolls into view and stop playing when it scrolls offscreen.
To test the autoplay feature, you can open a published template and append `?feedDebug=true` to the URL.
The template is loaded in the feed 10 times and you can swipe or scroll through to ensure the animation starts and stops as expected.
If you're not ready to publish the template, you can perform the same test by using *Debug in live player* in the *Remote* tab.
This opens a preview in a new browser tab.

[NOTE]
`Open in new tab` will not work.
This takes you to a staging area, where this feature is not available.

=== Testing using the Koji database

The Koji database provides an easy way for your project to store key/value pairs indefinitely.
See <<withkoji-database-package#>> for details on how to set up your template to access this database.
Once your project is set up to use the database, you can test it in the Koji editor.

In the pane on the left-hand side of the editor, scroll down until you see *ADVANCED*.

Click on this to display additional options.

Click on the *Database* option.
This will open the *Database* tab.
A list of your database tables will be displayed in the tab.

Click on a table name to display its contents.

You can now use *Live preview* to test your database setup.
Click on the *Default* tab under *Live preview*.
Perform an action in the preview that should write a record to the table.
Then click the *Refresh* button on the top left of the *Database* tab.
If the record insertion worked, you should see the new record displayed.

[NOTE]
It may take a few seconds for the database to be updated.
If the new record does not appear in the table, try refreshing again.

You can delete a record from the table by clicking the trashcan icon at the end of the row.
The preview will not be updated automatically.
You can force it to refresh by clicking on the *Remix* tab and then clicking back on the *Default* tab.

This testing method works equally well when running the Koji in a new tab, in production, on a mobile device, etc.
In those cases, you can just refresh the browser to update the Koji after deleting a record.

== Using browser tools for testing

All modern browsers provide tools for debugging websites.
You can access these tools when running your Koji as a preview in a separate tab, in *Live player*, or in the production environment.
How you navigate to these tools may vary, depending on what browser you're using.
The following directions are for the Google Chrome browser.
Other browsers should be similar.

Open the browser menu, click on *More tools*, and select *Developer tools*.
(You can get to the same screen by pressing the F12 key on a Windows machine.)
This will display a number of tabs, including the *Console* tab.
See *Writing to the console* for an example of how to use this tab.

The *Elements* tab displays the HTML code for the website.
If you move your cursor over the sections of code in this tab, the corresponding sections in the website will be highlighted.

If you right-click on a section of the website, this will open a menu from which you can select *Inspect*.
This will open the *Elements* tab (if it's not already open) and highlight the HTML code corresponding to that section.

Another menu option is *View page source*.
This displays the HTML code in the form that it was delivered to the browser.
For a simple website, this could be the same as the HTML code displayed in the *Elements* tab.
More likely, *Elements* will show the code after it has been modified by the browser.
The browser may do some error correction or normalization to the code.
Javascript running in the browser may significantly alter the HTML code, sometimes changing it beyond recognition.

In general, you will probably find *Inspect* to be more useful than *View page source*, but it's good to know that you have the option of viewing the unmodified code.

== Testing your Koji in the production environment

If you publish your template as *Unlisted*, you can test it under exactly the same conditions as a general user, but only you will have access to it.

Click *Publish form*.

Click *Show advanced options* near the bottom of the form.

Select the *Unlisted* checkbox.

image::publishUnlisted.jpg[Select *Unlisted*]

Click *Publish* and follow the directions to publish your template.
(See <<publish-locally-developed#,Publishing a project you developed locally>>.)

When you're ready to give general users access, just unselect the checkbox and republish the template.


= Testing templates
:page-slug: testing-templates
:page-description: Guide to testing Koji templates.

There are many powerful testing tools built into the Koji platform.
Typically, you will begin testing in the Koji editor.
Later, you'll want to publish the template as *Unlisted*, so you can test it in a production environment before giving access to general users.
Some of the most common testing methods are listed below.

== Testing in the Koji editor

The Koji editor provides various ways to preview a template's behavior.
These are covered in more detail in the documentation for the editor (see <<editor#>>).

=== Previewing the Koji

The *Live preview* tab allows you to toggle between *Preview* mode, which shows what the Koji looks like when running, and *Editing* mode, which allows you to perform remixing in the preview.

The *Remote* tab offers several additional ways of previewing your Koji.

* You can test it on your mobile device by scanning a QR code.
Logs from the mobile device will appear in a pane in the editor.

* You can open the Koji in a new tab.
Logs from the tab will appear in a pane in the editor.

* You can run it in a *live player*.
This opens another browser window where the Koji is displayed in an iframe, just as the published Koji is displayed.
Logs from the new browser window will appear in a pane in the editor.

* You can copy the link for the preview.
If you share this link with someone else, they can preview the Koji while it's still in development.
+
[NOTE]
The remote preview link will only work for as long as your editor session is still active, so it is not suitable for long-term sharing.

=== Testing backend routes

The *Routes* tab lets you test your backend routes.
It's similar to using a program like curl or Fiddler.
For instance, you can manually enter an HTTP request, configure a header for it, send the request, and examine the results returned by the server.

=== Previewing different contexts

A Koji can display different landing pages depending on the context in which it is running.
For more on contexts, see <<withkoji-vcc-package#_feedsdk#>>.

When running a Koji outside the editor, you can display its landing page by appending a query string to the URL.
For instance, if your Koji has an admin page, you can display it by appending `?context=admin` to the URL.

Inside the editor, the *Live preview* tab will display buttons for the following contexts if they exist in your Koji: *Admin*, *About*, *Sticker*, *Buyer Receipt*, *Seller Receipt*.
Clicking the button for one of these contexts displays a preview of its landing page.

You can use other names for custom contexts, but *Live preview* will not display buttons for them.
You will have to preview them by using the query string method.

=== Writing to the console

You can test JavaScript code by using the `console.log` method, which prints to the console.
To see the console in the Koji editor, open the *Thumbnail* tab and click the console button:
image:consoleButton.jpg[Console button]

For example, the following code snippet prints *Key pressed* to the console every time you press a key, as long as the *Live preview* pane is selected.

[NOTE]
You can select *Live preview* by clicking anywhere in its pane.

[source,javascript]
----
    $(window).keydown(function (e) {
        KEY_STATUS.keyDown = true;
        if (KEY_CODES[e.keyCode]) {
            e.preventDefault();
            KEY_STATUS[KEY_CODES[e.keyCode]] = true;
        }
        console.log("Key pressed");
    }).keyup(function (e) {
        KEY_STATUS.keyDown = false;
        if (KEY_CODES[e.keyCode]) {
            e.preventDefault();
            KEY_STATUS[KEY_CODES[e.keyCode]] = false;
        }
    });
----

When running your Koji outside the editor, either in production or as a preview, you can access the console through the browser's menu.
(See <<testing-templates#_using_browser_tools_for_testing,Using browser tools for testing>>.)

=== Testing In-app purchases

You can test *In-app purchases* by using *Debug in live player* on the *Remote* tab.

. First, make sure you've topped up your *Wallet* in *KojiPay*.
You'll be using the Koji to send money to yourself, so you can issue yourself a refund when you finish testing.

. Run your Koji in *Debug in live player* and try paying yourself a small amount.
If all goes well, you'll see this amount deducted from your *Wallet*.
The transaction will be marked *pending*.

. You should be able to refund the transaction, resetting your balance to its original value and cancelling the transaction fee.

[NOTE]
If *KojiPay* doesn't allow you to refund the transaction, wait a minute or two and try again.
It may not be finished processing.

=== Testing a social media share

When a user shares a remix of your template on social media, the Koji platform renders a rich preview (Open Graph) image based on a screenshot of the Koji.
You can preview this image by opening the *Thumbnail* tab in the *Live preview* pane.
See <<rich-preview-image#>> for how to customize the image.

=== Viewing messages passed between a Koji and platform APIs

Platform features like VCCs and in-app purchases require communication between your Koji and platform APIs.
To support that communication, your Koji is loaded into a "player" iframe inside the browser.
This allows messages to be sent from your Koji to the parent window and vice versa by using the `window.postMessage` api.
To view these messages, click the view messages button at the bottom of the *Live preview* pane:
image:messagesButton.jpg[View messages]

=== Testing feed autoplay

If you have videos or audio files in your Koji that play automatically, you may want them to play only when they are visible to the user.
For instance, if the user scrolls past a video, it should start playing when it first scrolls into view and stop playing when it scrolls offscreen.

To test the autoplay feature, click *Debug in live player* to open the Koji in a new tab (see <<testing-templates#_Previewing _the_Koji)>>).
Append `?feedDebug=true` to the URL.
The template is loaded in the feed 10 times and you can swipe or scroll through to ensure the animation starts and stops as expected.
You can perform the same test in production mode.

[NOTE]
`Open in new tab` will not work.
This takes you to a staging area, where this feature is not available.

=== Using the database explorer

If your project uses the <<koji-database#,Koji database>>, you can test transactions by using the database explorer.

In the editor, select *ADVANCED > Database*.
A list of your collections opens.

Click a collection in the list to display its contents.

You can now use *Live preview > Default* to test your database setup.
Perform an action in the preview that should write a record to the selected collection, then click *Refresh* in the *Database* tab.
If the record insertion worked, you should see the new record displayed.

[NOTE]
It may take a few seconds for the database to be updated.
If the new record does not appear in the collection, try refreshing again.

You can delete a record from the collection by clicking the trashcan icon at the end of the row.
The preview will not be updated automatically.
You can force it to refresh by clicking the *Remix* tab and then clicking back on the *Default* tab.

This testing method works equally well when running the Koji in a new tab or on a mobile device.
In this case, you must refresh the browser to update the Koji after deleting a record.

== Using browser tools for testing

All modern browsers provide tools for debugging websites.
For example, in Google Chrome, you can open the debugging tools by clicking *More tools > Developer tools* or by pressing the F12 key.

== Testing your Koji in the production environment

If you publish your template as *Unlisted*, you can test it under exactly the same conditions as a general user, but no one else will have access unless you send them the direct link.

. In the upper left of the editor, click *Publish now* to open the publish settings.
. Review the name and description, and update them if desired.
. Click *Show advanced options* near the bottom of the form.
. Select *Unlisted*.
. Click *Publish*.
. When publishing is completed, click the link to view and test your updated template.
. When you're ready to give general users access, clear *Unlisted* and republish the template.


= Anatomy of a Koji project
:page-slug: projects
:page-description: Description of the unique features and files in a Koji project that power the magic of customization.

A Koji project contains everything that defines a template, including the source code, build configurations, and unique configuration files that power Koji features.
When you fork a scaffold or another template to start your new template, the Koji platform creates a clone of the underlying project and opens it in the Koji editor.

As you add in the logic for your template, you must consider what additional features to offer, and then design experiences for different types of users and the different ways they might use it.
This page provides an overview of the functional considerations for a Koji template and a description of the required files and elements to power them.

//Koji provides you with an environment for developing and publishing an application in your browser.
//The project environment includes a terminal connected to a running container with all the familiar tools, the same code editor that powers VSCode, and tools to help you deploy and publish your application to https://withkoji.com[withkoji.com].

//== Koji template features and functions

== Git repositories

Koji projects use Git repositories for source control.
A project directory on the Koji CDN stores the underlying code base and configuration files for each template.
When you fork a scaffold or template, the underlying project directory is cloned, and your new project directory is associated with the following Git repositories.

* `origin` â€“ The Git repository for your project.
Your template is built and deployed from this repository.
To work locally, you can clone this repository and push changes to it.
* `upstream` â€“ The Git repository from which your project was forked.
To propose changes to the template you forked, you can create pull requests for this repository.

When you open your project in the Koji editor, the development environment includes the project directory at `/usr/src/app` and Git remotes for these repositories.
To see the remotes from the editor, you can open a terminal tab and run `git remote -v`.

[source,bash]
----
root@c8ce449b5538:/usr/src/app# git remote -v
origin  https://projects.koji-cdn.com/8a129043-4c22-4be7-875f-38b422008695.git (fetch)
origin  https://projects.koji-cdn.com/8a129043-4c22-4be7-875f-38b422008695.git (push)
upstream        https://projects.koji-cdn.com/e4d6b4bf-781a-4a49-9f0f-1d9cf3bbb7ff.git (fetch)
upstream        https://projects.koji-cdn.com/e4d6b4bf-781a-4a49-9f0f-1d9cf3bbb7ff.git (push)
----

== Project directory structure and contents

A typical Koji project contains the `.koji` directory, which includes the configuration and build files for your template, a directory for each service in the application, and a README file.
For example:

[source,console]
----
.koji
â”œâ”€â”€ customization
â”‚   â”œâ”€â”€ about_customization.md
â”‚   â”œâ”€â”€ colors.json
â”‚   â”œâ”€â”€ images.json
â”‚   â”œâ”€â”€ settings.json
â”œâ”€â”€ project
â”‚   â”œâ”€â”€ about_project.md
â”‚   â”œâ”€â”€ deploy.json
â”‚   â”œâ”€â”€ develop.json
â”‚   â””â”€â”€ entitlements.json
frontend
â”œâ”€â”€ common
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
README.md
----

For your project to be built and deployed as a template on the Koji platform, the only required files are `develop.json` and `deploy.json`, in the `.koji/project` directory, and `README.md`, at the top level.

In addition, specific files and elements are required to enable the Koji features that are implemented in your template, including JSON files for supporting custom values, in the `.koji/customization` directory, and the `entitlements.json` file, in the `.koji/project` directory.

////
=== .koji directory

The `.koji` directory contains the configuration and script files, including project configuration for development and deploy and customizations for Visual Customization Controls (VCCs).

[source,console]
----
.koji
â”œâ”€â”€ customization
â”‚   â”œâ”€â”€ about_customization.md
â”‚   â”œâ”€â”€ colors.json
â”‚   â”œâ”€â”€ images.json
â”‚   â”œâ”€â”€ settings.json
â”œâ”€â”€ project
â”‚   â”œâ”€â”€ about_project.md
â”‚   â”œâ”€â”€ deploy.json
â”‚   â”œâ”€â”€ develop.json
â”‚   â””â”€â”€ entitlements.json
----

[IMPORTANT]
====
The only required files for Koji to work are:

* `README.md`: Displays project information in the project overview.
* `develop.json`: Lets the Koji editor know how your project development works (project path, port, start command, and events).
* `deploy.json`: Lets deploy know where your project build works (build path, port, build commands).
====
////

=== develop.json

The `.koji/project/develop.json` file contains the development configuration for your project.

[source,JSON]
----
{
  "develop": {
    "frontend": {
      "path": "frontend",
      "port": 8080,
      "startCommand": "npm start"
    }
  }
}
----

In this file the important things to look at are:

* `path`: Indicates the directory for your frontend and backend.
* `port`:  Matches the port on which your development server is running.
* `startCommand` for your application is placed in the start script of your package.json (for npm start to work).

=== deploy.json

`.koji/project/deploy.json` contains deploy configuration for your project.

[source,JSON]
----
{
  "deploy":  {
    "frontend":  {
      "output":  "frontend/build",
      "commands":  [
        "cd frontend",
        "npm install",
        "export NODE_ENV=production && npm run compile"
      ],
    },
    "backend":  {
      "output":  "backend/dist",
      "type": "dynamic",
      "commands":  [
        "cd backend",
        "npm install",
        "export NODE_ENV=production && npm run compile"
      ]
    }
  }
}
----

In `deploy.json` make sure to check that:

* `output`: Indicates the directory where your files will be compiled after the `"commands"` list is done.

* `type`: Is either `static` if the service deploys a static bundle (HTML, CSS, JS), or `dynamic` if the service deploys a server.
* `commands`: Lists the steps to build your project.

The .json files in this directory each have a very specific schema that controls how the Koji editor deals with files.
develop.json deals with setting up your editor so you will have the best editing experience and deploy.json tells Koji how to turn your code into a live app.
These files have the following schema:

=== .koji/customization

The JSON files in this directory define the names, types, configuration options, and default values for VCCs used in the template.
Every file created in this directory is displayed in the VCC Explorer section in the left navigation pane.

The following file would be saved as `example.json` and displayed in the left pane as *Example*:

[source,JSON]
----
{
  "example":  {
    "param":  "this is the value of the param"
  },
  "@@editor":  [
    {
      "key":  "example",
      "name":  "Example",
      "icon":  "ðŸ˜„",
      "source":  "example.json",
      "fields":  [
        {
          "key":  "param",
          "name":  "An Example Parameter",
          "type":  "text"
        }
      ]
    }
  ]
}
----

If you are using the <<withkoji-vcc-package#>> package, you can access this property with `instantRemixing.get(['example', 'param'])`.

=== README

The `README.md` file is required at the top level your project directory.
This markdown file should document the tech stack and any relevant information to aid someone working with the code.

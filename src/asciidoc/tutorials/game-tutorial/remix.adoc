= Adding remix options
:page-slug: game-remix
:page-description: Modifying the Remix menu for a Falling Objects game so that anyone can customize it.
:figure-caption!:

In the <<game-managing-difficulty#, previous section>> of the remixable game tutorial, you finished adding the main functionality for a Falling Objects game.
But, there's more to do to get the full value of Koji.

In this section, youâ€™ll
// tag::description[]
make the game easily remixable by other people so it can be shared everywhere online.
// end::description[]

By the end of this section, you should feel comfortable:

* Editing the remix menu in the game template.
* Adding a customizable image to the menu.

== Exploring the remix menu

The game template provides a configurable remix menu to speed up game development on Koji.

If you open `frontend/src/Components/Remix/index.js`, you'll see that some of the workflow you need for your game is already set up.

[NOTE]
To see what the Remix menu currently looks like, use the `Remix` tab of the <<testing-templates#_using_the_koji_debugger, Debugger>> or the Live Preview in the Koji editor.

The *Background Image* and *Music* customizations are already handled by the template, so you can just leave them as they are.

Luckily, since we've already made a generic `Player` class that uses `imgPlayer` for its image, everything is already set up for our player to be customizable.

image:https://i.imgur.com/PvpEy66.png[alt="screenshot player",width=256,height=256]

To test it out, try changing the `Player` image.
If necessary, refresh the preview.
Our player is different now!

== Adding the Collectible image to Remix menu

Let's make our `Collectible` image customizable, as well.

=== Setting up state hooks

First, let's make a State Hook that will represent our `Collectible` image and assign some initial values.
Modify `index.js` as follows.

[source,javascript]
-------------------
...
const Component = () => {
    ...
    const [imgCollectible, setImgCollectible] = useState("");
    const [isCollectibleInvalid, setIsCollectibleInvalid] = useState("");
    ...

    const assignInitialValues = () => {
        const remixValues = Koji.remix.get();
        ...

        setImgCollectible(remixValues.imgCollectible);

        ...
    })
}
-------------------

Notice that we also created an `isCollectibleInvalid` state hook.
We'll use it to make sure the user has actually uploaded an image.
We don't want them to publish the game without one.

Then, in `assignInitialValues()`, which is inside our useEffect Hook when the Remix component mounts, we assign the initial value from `koji.json`.

`setImgCollectible(remixValues.imgCollectible);`

=== Defining functions that let us change the image

We also need to define some functions that will let us change or delete the collectible image.

[source,javascript]
-------------------
...
const Component = () => {
    ...

    const changeCollectible = async () => {
        const imageUrl = await Koji.ui.capture.image();
        if (!imageUrl || imageUrl === "") return;

        setImgCollectible(imageUrl);
        setIsCollectibleInvalid(false);
        await Koji.remix.set({ imgCollectible: imageUrl })
        updateGame();
    }

    const deleteCollectible = async () => {
        setImgCollectible("");
        await Koji.remix.set({ imgCollectible: "" })
        updateGame();
    }

    ...
}
-------------------

To capture our image, we use the `@withkoji/core` package, which lets us upload an image, paste one from a link, or choose one from one of the asset packs.

`Koji.ui.capture.image()` will return `null` if the user cancels image selection, so we also include a simple check to make sure that's not the case.

Then we:

* Update our `imgCollectible` state hook with the resulting image.

* Reset the `isCollectibleInvalid` state hook.

* Update our `imgCollectible` remix value with the resulting image.

* Update the game.

We want to update our game here because we have a running game preview behind our Remix panel.
If you change something isn't instantly previewable inside the game, this step can be skipped.

Inside `deleteCollectible()`, we do the same thing, except we set `imgCollectible` to an empty string, instead of capturing an image.

=== Rendering the image component

Next, let's render the component that represents a collectible image and lets us customize it.
We can once again use the existing structure from `Player`.

Find the component that looks like the following.

[source,javascript]
-------------------
<div>
    <Label>
        <b>{"Player"}</b>
    </Label>
    <ImageButton
        src={optimizeImage(imgPlayer, 120, 120)}
        canDelete={canUpdateImages}
        onClick={changeImgPlayer}
        onDelete={deletePlayer}
        isInvalid={isPlayerInvalid}
    />
</div>
-------------------

Make a copy just below it, still inside the `<Section>` component and modify it as follows.

[source,javascript]
-------------------
<div>
    <Label>
        <b>{"Collectible"}</b>
    </Label>
    <ImageButton
        src={optimizeImage(imgCollectible, 120, 120)}
        canDelete={canUpdateImages}
        onClick={changeCollectible}
        onDelete={deleteCollectible}
        isInvalid={isCollectibleInvalid}
    />
</div>
-------------------

=== Updating the finish() function

Lastly, we want to modify the `finish()` function to prevent the user from publishing if they haven't uploaded an image.

That logic is already in place for `imgPlayer`, so we can just modify it to include `imgCollectible`.

[source,javascript]
-------------------
const finish = async () => {
    if (imgPlayer === "" || imgCollectible === "") {
        setErrorLabel("Complete the required selections to continue.");

        if (imgPlayer === "") {
            setIsPlayerInvalid(true);
        }

        if (imgCollectible === "") {
            setIsCollectibleInvalid(true);
        }

        return;
    }

    await Koji.remix.set({
        backgroundImage,
        music,
        title,
    })
    Koji.remix.finish();
}
-------------------

[NOTE]
We don't need to explicitly set `imgPlayer` and `imgCollectible` inside the `Koji.remix.set()` function, because we've already done it in our `onChange` handlers.

image:https://i.imgur.com/F5BamYt.png[alt="screenshot player",width=256,height=256]

== Wrapping up

That's our `Remix` mode finished! We've just added the ability for users to change the `Collectible` image!

In the <<game-thumbnail-preview#,next section>>, we will customize our thumbnail preview.
